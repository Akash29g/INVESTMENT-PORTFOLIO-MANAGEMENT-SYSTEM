--USER:
 
CREATE TABLE USER(
PAN_ID VARCHAR(20),
NAME VARCHAR(20),
DATE_OF_BIRTH DATE,
ADDRESS VARCHAR(30),
EMAIL VARCHAR(30),
PHONE_NO VARCHAR(10),
PRIMARY KEY(PAN_ID)
);

pragma table_info('user');

 
--PORTFOLIO:
 
CREATE TABLE PORTFOLIO(
PORTFOLIO_ID VARCHAR(10),
PAN_ID VARCHAR(10),
PORTFOLIO_NAME VARCHAR(20),
DATE_OF_CREATION DATE,
PRIMARY KEY(PORTFOLIO_ID),
FOREIGN KEY (PAN_ID) REFERENCES USER(PAN_ID)
);

pragma table_info(‘portfolio’);

 

 
--TRANSACTIONS:
 
CREATE TABLE TRANSACTIONS(
TRANSACTION_ID VARCHAR(10),
PORTFOLIO_ID VARCHAR(10),
AMOUNT FLOAT,
ASSET_TYPE VARCHAR(10),
TRANSACTION_DATE DATE,
PRIMARY KEY (TRANSACTION_ID),
FOREIGN KEY (PORTFOLIO_ID) REFERENCES PORTFOLIO(PORTFOLIO_ID)
);

pragma table_info('transactions');
 
--STOCK_BUY:

CREATE TABLE STOCK_BUY( 
TRANSACTION_ID VARCHAR(10), 
QUANTITY INT, 
DUMMY_QUANTITY INT,
ISIN VARCHAR(12), 
PRIMARY KEY(TRANSACTION_ID, ISIN), 
FOREIGN KEY (TRANSACTION_ID) REFERENCES TRANSACTIONS (TRANSACTION_ID) 
);

pragma table_info('stock_buy');
 

--STOCK_SELL:

CREATE TABLE STOCK_SELL( 
TRANSACTION_ID VARCHAR(10), 
QUANTITY INT, 
ISIN VARCHAR(12), 
PRIMARY KEY(TRANSACTION_ID, ISIN), 
FOREIGN KEY (TRANSACTION_ID) REFERENCES TRANSACTIONS (TRANSACTION_ID) 
);

pragma table_info('stock_sell');
 
--STOCKS:

CREATE TABLE STOCKS( 
ISIN VARCHAR(12), 
PORTFOLIO_ID VARCHAR(10), 
TOTAL_QUANTITY INT, 
AVERAGE_PRICE_PER_SHARE FLOAT, 
NET_GAIN FLOAT, 
PRIMARY KEY(PORTFOLIO_ID, ISIN), 
FOREIGN KEY (PORTFOLIO_ID) REFERENCES PORTFOLIO(PORTFOLIO_ID) 
);

pragma table_info('stocks');
 

--STOCK_INFO:

CREATE TABLE STOCK_INFO( 
ISIN VARCHAR(12), 
STOCK_NAME VARCHAR(30), 
CURRENT_VALUE FLOAT, 
P_E_RATIO FLOAT, 
PRIMARY KEY(ISIN) 
);

 
--FIXED_DEPOSITS:

CREATE TABLE FIXED_DEPOSITS( 
STARTING_DATE DATE, 
ACCOUNT_NO VARCHAR(20), 
DURATION FLOAT, 
BANK VARCHAR(30), 
RETURN_ON_INVESTMENT FLOAT, 
PORTFOLIO_ID VARCHAR(10), 
AMOUNT FLOAT,
PRIMARY KEY (PORTFOLIO_ID, ACCOUNT_NO), 
FOREIGN KEY (PORTFOLIO_ID) REFERENCES PORTFOLIO (PORTFOLIO_ID) 
);

pragma table_info('fixed_deposits');
 

--GOVT_BONDS:

CREATE TABLE GOVT_BONDS( 
BOND_ID VARCHAR(10), 
STARTING_DATE DATE, 
AMOUNT FLOAT, 
DURATION FLOAT, 
RETURN_ON_INVESTMENT FLOAT,
PORTFOLIO_ID VARCHAR(10), 
PRIMARY KEY (PORTFOLIO_ID, BOND_ID), 
FOREIGN KEY (PORTFOLIO_ID) REFERENCES PORTFOLIO (PORTFOLIO_ID) 
);

pragma table_info('govt_bonds');

 

--SCHEMES
CREATE TABLE SCHEMES(
CURRENT_NAV FLOAT,
DEBT_ISSUER VARCHAR(40),
PRIMARY KEY(DEBT_ISSUER)
);
pragma table_info('schemes');

 

--MUTUAL_FUNDS
CREATE TABLE MUTUAL_FUNDS(
BALANCE_UNITS FLOAT,
DEBT_ISSUER VARCHAR(40),
STARTING_DATE DATE,
FOLIO_ID VARCHAR(10),
PORTFOLIO_ID VARCHAR(10),
FOREIGN KEY (PORTFOLIO_ID) REFERENCES PORTFOLIO(PORTFOLIO_ID),
FOREIGN KEY(DEBT_ISSUER) REFERENCES SCHEMES(DEBT_ISSUER),
PRIMARY KEY(FOLIO_ID,PORTFOLIO_ID)
);
pragma table_info('mutual_funds');

 
--MF_UNITS_SELL
CREATE TABLE MF_UNITS_SELL	(
QUANTITY FLOAT,
TRANSACTION_ID VARCHAR(10),
FOLIO_ID VARCHAR(10),
  PORTFOLIO_ID VARCHAR(10),
FOREIGN KEY (PORTFOLIO_ID) REFERENCES PORTFOLIO(PORTFOLIO_ID),
PRIMARY KEY(TRANSACTION_ID,PORTFOLIO_ID,FOLIO_ID)
);
pragma table_info('mf_units_sell');
 
--SIP
CREATE TABLE SIP(
INSTALLMENT_DATE DATE,
QUANTITY_BOUGHT FLOAT,
  	QUANTITY_REVISED FLOAT,
NAV FLOAT,
FOLIO_ID VARCHAR(10),
  PORTFOLIO_ID VARCHAR(10),
FOREIGN KEY(FOLIO_ID,PORTFOLIO_ID) REFERENCES MUTUAL_FUNDS(FOLIO_ID,PORTFOLIO_ID),
 
PRIMARY KEY(FOLIO_ID,PORTFOLIO_ID,INSTALLMENT_DATE)
);
pragma table_info('sip');


 


--SQL QUERIES

--ALL USERS HERE
INSERT INTO USER VALUES('AGAKG9943X','AKASH GOSWAMI','2005-01-15','BANGALORE','akash@gmail.com',9123456789);
INSERT INTO USER VALUES('SKSKY8821B','SUHAAS KARTHIKEYAN','2005-11-21','CHENNAI','suhaas@gmail.com',9988776655);
INSERT INTO USER VALUES('JKJSK8765M','JENSEN K','2005-06-02','KOCHI','jensen@gmail.com',9876543210);
INSERT INTO USER VALUES('PSPSH3190N','PRATYUSH SINGH','2004-08-18','LUCKNOW','pratyush@gmail.com',7766554433);
INSERT INTO USER VALUES('NSNSG4507D','NIHAR SAGAR','2003-12-30','HYDERABAD','nihar@gmail.com',8899001122);


SELECT * FROM USER;

 

--ALL PORTFOLIOS HERE
INSERT INTO PORTFOLIO VALUES('AG101','AGAKG9943X','TRIAL_FOLIO','2025-01-26');
INSERT INTO PORTFOLIO VALUES('AG102','AGAKG9943X','EATING_OUT','2025-02-27');
INSERT INTO PORTFOLIO VALUES('SK101','SKSKY8821B','GUITAR_FOLIO','2025-01-16');
INSERT INTO PORTFOLIO VALUES('SK102','SKSKY8821B','BASS_FOLIO','2025-02-17');
INSERT INTO PORTFOLIO VALUES('JK101','JKJSK8765M','BA_FOLIO','2025-02-17');
INSERT INTO PORTFOLIO VALUES('PS101','PSPSH3190N','BIRYANI_FOLIO','2025-03-08');
INSERT INTO PORTFOLIO VALUES('NS101','NSNSG4507D','BATMAN_FOLIO','2025-01-12');


SELECT * FROM PORTFOLIO;

 


--STEP-WISE FOR EVERY OPERATION NOW

-- BUYING 10 STOCKS OF INFOSYS FOR THE 1ST TIME 
INSERT INTO TRANSACTIONS VALUES('TAPST101','AG101',1000,'STOCKS','2025-03-16');

 

INSERT INTO STOCK_BUY VALUES('TAPST101',10,0,'INE009A01021');
 
UPDATE STOCK_BUY SET DUMMY_QUANTITY = QUANTITY WHERE TRANSACTION_ID = 'TAPST101';
 

INSERT INTO STOCKS VALUES('INE009A01021','AG101',0,0,0);
 

INSERT INTO STOCK_INFO VALUES('INE009A01021','INFOSYS',1490.25,25.68);
 

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101')
WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101';
 

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101')
WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101')
) WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101';

 

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE009A01021' AND PORTFOLIO_ID = 'AG101')
WHERE STOCKS.ISIN = 'INE009A01021' AND PORTFOLIO_ID = 'AG101';
 
 
-- BUYING ANOTHER 10 STOCKS OF INFOSYS AT A DIFFERENT PRICE
INSERT INTO TRANSACTIONS VALUES('TAPST102','AG101',2000,'STOCKS','2025-03-17');

INSERT INTO STOCK_BUY VALUES('TAPST102',10,0,'INE009A01021');
UPDATE STOCK_BUY SET DUMMY_QUANTITY = QUANTITY WHERE TRANSACTION_ID = 'TAPST102';

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101')
WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101')
WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101')
) WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE009A01021' AND PORTFOLIO_ID = 'AG101')
WHERE STOCKS.ISIN = 'INE009A01021' AND PORTFOLIO_ID = 'AG101';

 

-- SELLING 13 STOCKS OF INFOSYS USING FIFO MECHANISM

INSERT INTO TRANSACTIONS VALUES('TSTAP101','AG101',-13000,'STOCKS','2025-03-17');

INSERT INTO STOCK_SELL VALUES('TSTAP101',13,'INE009A01021');

 

UPDATE STOCK_BUY SET dummy_quantity = 0 WHERE TRANSACTION_ID = 'TAPST101';
UPDATE STOCK_BUY SET dummy_quantity = 7 WHERE TRANSACTION_ID = 'TAPST102';

 

--As it can be seen changes made according to FIFO mechanism in stocks

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101')
WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101')
WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101')
) WHERE ISIN = 'INE009A01021' AND portfolio_id = 'AG101';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE009A01021' AND PORTFOLIO_ID = 'AG101')
WHERE STOCKS.ISIN = 'INE009A01021' AND PORTFOLIO_ID = 'AG101';

 

-- BUYING 10 STOCKS OF RELIANCE FOR ANOTHER USER

INSERT INTO TRANSACTIONS VALUES('TSVST101','SK101',30000,'STOCKS','2025-02-03');

INSERT INTO STOCK_BUY VALUES('TSVST101',10,0,'INE002A01018');
UPDATE STOCK_BUY SET DUMMY_QUANTITY = QUANTITY WHERE TRANSACTION_ID = 'TSVST101';

INSERT INTO STOCKS VALUES('INE002A01018','SK101',0,0,0);

INSERT INTO STOCK_INFO VALUES('INE002A01018','RELIANCE',2983.65,39.19);

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE002A01018' AND portfolio_id = 'SK101')
WHERE ISIN = 'INE002A01018' AND portfolio_id = 'SK101';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE002A01018' AND portfolio_id = 'SK101')
WHERE ISIN = 'INE002A01018' AND portfolio_id = 'SK101')
) WHERE ISIN = 'INE002A01018' AND portfolio_id = 'SK101';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE002A01018' AND PORTFOLIO_ID = 'SK101')
WHERE STOCKS.ISIN = 'INE002A01018' AND PORTFOLIO_ID = 'SK101';

-- BUYING 5 MORE STOCKS OF RELIANCE FOR THIS USER

INSERT INTO TRANSACTIONS VALUES('TSVST102','SK101',12000,'STOCKS','2025-02-04');

INSERT INTO STOCK_BUY VALUES('TSVST102',5,0,'INE002A01018');
UPDATE STOCK_BUY SET DUMMY_QUANTITY = QUANTITY WHERE TRANSACTION_ID = 'TSVST102';

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE002A01018' AND portfolio_id = 'SK101')
WHERE ISIN = 'INE002A01018' AND portfolio_id = 'SK101';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE002A01018' AND portfolio_id = 'SK101')
WHERE ISIN = 'INE002A01018' AND portfolio_id = 'SK101')
) WHERE ISIN = 'INE002A01018' AND portfolio_id = 'SK101';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE002A01018' AND PORTFOLIO_ID = 'SK101')
WHERE STOCKS.ISIN = 'INE002A01018' AND PORTFOLIO_ID = 'SK101';

-- 1st user is buying a few stocks of reliance now

INSERT INTO TRANSACTIONS VALUES('TAPST104','AG101',13000,'STOCKS','2025-02-07');

INSERT INTO STOCK_BUY VALUES('TAPST104',6,0,'INE002A01018');
UPDATE STOCK_BUY SET DUMMY_QUANTITY = QUANTITY WHERE TRANSACTION_ID = 'TAPST104';

select * from stock_buy;

INSERT INTO STOCKS VALUES('INE002A01018','AG101',0,0,0);

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE002A01018' AND portfolio_id = 'AG101')
WHERE ISIN = 'INE002A01018' AND portfolio_id = 'AG101';

select * from stocks;

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE002A01018' AND portfolio_id = 'AG101')
WHERE ISIN = 'INE002A01018' AND portfolio_id = 'AG101')
) WHERE ISIN = 'INE002A01018' AND portfolio_id = 'AG101';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE002A01018' AND PORTFOLIO_ID = 'AG101')
WHERE STOCKS.ISIN = 'INE002A01018' AND PORTFOLIO_ID = 'AG101';

-- lets get count of how many total portfolios have this stock
select STOCK_NAME, count(PORTFOLIO_ID) AS NO_OF_PORTFOLIOS from 
STOCK_INFO JOIN
stocks ON STOCKS.ISIN = STOCK_INFO.ISIN group by STOCKS.isin having STOCKS.ISIN = 'INE002A01018';

 

-- total stocks bought by multiple users for reliance

select STOCK_NAME, sum(total_quantity) from 
STOCK_INFO JOIN
stocks ON STOCKS.ISIN = STOCK_INFO.ISIN group by STOCKS.isin having STOCKS.isin = 'INE002A01018';

 

-- buying a few stocks of hdfc bank by 1st user but different portfolio

INSERT INTO TRANSACTIONS VALUES('TAPST105','AG102',12000,'STOCKS','2025-02-07');

insert into STOCK_BUY VALUES('TAPST105',8,0,'INE0040A01034');
UPDATE STOCK_BUY SET DUMMY_QUANTITY = QUANTITY WHERE TRANSACTION_ID = 'TAPST105';

insert into stock_info values('INE0040A01034', 'HDFC BANK',1445.70,23.92);

insert into STOCKS values('INE0040A01034','AG102',0,0,0);

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE0040A01034' AND portfolio_id = 'AG102')
WHERE ISIN = 'INE0040A01034' AND portfolio_id = 'AG102';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE0040A01034' AND portfolio_id = 'AG102')
WHERE ISIN = 'INE0040A01034' AND portfolio_id = 'AG102')
) WHERE ISIN = 'INE0040A01034' AND portfolio_id = 'AG102';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE0040A01034' AND PORTFOLIO_ID = 'AG102')
WHERE STOCKS.ISIN = 'INE0040A01034' AND PORTFOLIO_ID = 'AG102';

SELECT * FROM STOCKS;

-- LETS GET TOTAL NUMBER OF STOCKS OWNED BY THE SAME USER IN ALL PORTFOLIOS, PAN_ID WISE

SELECT PORTFOLIO.PAN_ID, COUNT(ISIN) AS NUMBER_OF_COMPANIES FROM 
STOCKS JOIN PORTFOLIO ON STOCKS.PORTFOLIO_ID = PORTFOLIO.PORTFOLIO_ID 
GROUP BY PORTFOLIO.PAN_ID
HAVING PORTFOLIO.PAN_ID = 'AGAKG9943X';



 

-- USER’S NAME WISE

SELECT USER.NAME AS USERNAME, COUNT(ISIN) AS NUMBER_OF_COMPANIES FROM 
STOCKS JOIN PORTFOLIO ON STOCKS.PORTFOLIO_ID = PORTFOLIO.PORTFOLIO_ID 
JOIN USER ON PORTFOLIO.PAN_ID = USER.PAN_ID
GROUP BY PORTFOLIO.PAN_ID
HAVING USER.NAME = 'SUHAAS KARTHIKEYAN';

 

-- 2ND USER BUYS STOCKS OF ZOMATO

INSERT INTO TRANSACTIONS VALUES('TSVST201','SK101',3400,'STOCKS','2023-11-05');

insert into STOCK_BUY VALUES('TSVST201',8,0,'INE758T01015');
UPDATE STOCK_BUY SET DUMMY_QUANTITY = QUANTITY WHERE TRANSACTION_ID = 'TSVST201';

insert into stock_info values('INE758T01015', 'ZOMATO',179.65,847.98);

insert into STOCKS values('INE758T01015','SK101',0,0,0);

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE758T01015' AND portfolio_id = 'SK101')
WHERE ISIN = 'INE758T01015' AND portfolio_id = 'SK101';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE758T01015' AND portfolio_id = 'SK101')
WHERE ISIN = 'INE758T01015' AND portfolio_id = 'SK101')
) WHERE ISIN = 'INE758T01015' AND portfolio_id = 'SK101';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE758T01015' AND PORTFOLIO_ID = 'SK101')
WHERE STOCKS.ISIN = 'INE758T01015' AND PORTFOLIO_ID = 'SK101';

-- TOTAL UNREALISED GAIN FOR AKASH GOSWAMI (1st User)

SELECT USER.NAME AS USERNAME,SUM(NET_GAIN) AS UNREALISED_GAIN_STOCKS FROM 
STOCKS JOIN PORTFOLIO ON STOCKS.PORTFOLIO_ID = PORTFOLIO.PORTFOLIO_ID 
JOIN USER ON PORTFOLIO.PAN_ID = USER.PAN_ID
GROUP BY PORTFOLIO.PAN_ID
HAVING USER.NAME = 'AKASH GOSWAMI';

 
        
-- 2ND USER SELLING SOME STOCKS

INSERT INTO TRANSACTIONS VALUES('TSTSV201','SK101',-2000,'STOCKS','2023-11-09');

INSERT INTO STOCK_SELL VALUES('TSTSV201',4,'INE758T01015');

UPDATE STOCK_BUY SET dummy_quantity = 4 WHERE transaction_id = 'TSVST201';

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE758T01015' AND portfolio_id = 'SK101')
WHERE ISIN = 'INE758T01015' AND portfolio_id = 'SK101';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE758T01015' AND portfolio_id = 'SK101')
WHERE ISIN = 'INE758T01015' AND portfolio_id = 'SK101')
) WHERE ISIN = 'INE758T01015' AND portfolio_id = 'SK101';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE758T01015' AND PORTFOLIO_ID = 'SK101')
WHERE STOCKS.ISIN = 'INE758T01015' AND PORTFOLIO_ID = 'SK101';

-- BUYING A FEW STOCKS OF MARICO

INSERT INTO TRANSACTIONS VALUES('TKSST101','JK101',11200,'STOCKS','2025-02-05');

insert into STOCK_BUY VALUES('TKSST101',28,0,'INE196A01026');
UPDATE STOCK_BUY SET DUMMY_QUANTITY = QUANTITY WHERE TRANSACTION_ID = 'TKSST101';

insert into stock_info values('INE196A01026', 'MARICO',497.20,51.21);

insert into STOCKS values('INE196A01026','JK101',0,0,0);

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101')
WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101')
WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101')
) WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE196A01026' AND PORTFOLIO_ID = 'JK101')
WHERE STOCKS.ISIN = 'INE196A01026' AND PORTFOLIO_ID = 'JK101';

-- SELLING A FEW STOCKS OF MARICO 

INSERT INTO TRANSACTIONS VALUES('TSTKS101','JK101',-1200,'STOCKS','2025-02-05');

INSERT INTO STOCK_SELL VALUES('TSTKS101',2,'INE196A01026');
UPDATE STOCK_BUY SET dummy_quantity = 26 WHERE transaction_id = 'TKSST101';

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101')
WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101')
WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101')
) WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE196A01026' AND PORTFOLIO_ID = 'JK101')
WHERE STOCKS.ISIN = 'INE196A01026' AND PORTFOLIO_ID = 'JK101';

-- SELLING A FEW MORE STOCKS OF THE SAME USER

INSERT INTO TRANSACTIONS VALUES('TSTKS102','JK101',-3200,'STOCKS','2025-02-05');

INSERT INTO STOCK_SELL VALUES('TSTKS102',4,'INE196A01026');

UPDATE STOCK_BUY SET dummy_quantity = 22 WHERE transaction_id = 'TKSST101';

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101')
WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101')
WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101')
) WHERE ISIN = 'INE196A01026' AND portfolio_id = 'JK101';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE196A01026' AND PORTFOLIO_ID = 'JK101')
WHERE STOCKS.ISIN = 'INE196A01026' AND PORTFOLIO_ID = 'JK101';

-- BUYING STOCKS OF TCS FOR SK102

INSERT INTO TRANSACTIONS VALUES('TSVST301','SK102',63000,'STOCKS','2025-02-15');

insert into STOCK_BUY VALUES('TSVST301',18,0,'INE467B01029');
UPDATE STOCK_BUY SET DUMMY_QUANTITY = QUANTITY WHERE TRANSACTION_ID = 'TSVST301';

insert into stock_info values('INE467B01029', 'TCS',3876.30,34.87);

insert into STOCKS values('INE467B01029','SK102',0,0,0);

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE467B01029' AND portfolio_id = 'SK102')
WHERE ISIN = 'INE467B01029' AND portfolio_id = 'SK102';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE467B01029' AND portfolio_id = 'SK102')
WHERE ISIN = 'INE467B01029' AND portfolio_id = 'SK102')
) WHERE ISIN = 'INE467B01029' AND portfolio_id = 'SK102';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE467B01029' AND PORTFOLIO_ID = 'SK102')
WHERE STOCKS.ISIN = 'INE467B01029' AND PORTFOLIO_ID = 'SK102';

-- BUYING MORE STOCKS OF TCS FOR SK102

INSERT INTO TRANSACTIONS VALUES('TSVST302','SK102',43400,'STOCKS','2025-02-15');

insert into STOCK_BUY VALUES('TSVST302',14,0,'INE467B01029');
UPDATE STOCK_BUY SET DUMMY_QUANTITY = QUANTITY WHERE TRANSACTION_ID = 'TSVST302';

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE467B01029' AND portfolio_id = 'SK102')
WHERE ISIN = 'INE467B01029' AND portfolio_id = 'SK102';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE467B01029' AND portfolio_id = 'SK102')
WHERE ISIN = 'INE467B01029' AND portfolio_id = 'SK102')
) WHERE ISIN = 'INE467B01029' AND portfolio_id = 'SK102';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE467B01029' AND PORTFOLIO_ID = 'SK102')
WHERE STOCKS.ISIN = 'INE467B01029' AND PORTFOLIO_ID = 'SK102';

-- BUYING STOCKS OF TATA MOTORS FOR 4TH USER (PRATYUSH SINGH)

INSERT INTO TRANSACTIONS VALUES('TSPST101','PS101',90000,'STOCKS','2025-01-29');

insert into STOCK_BUY VALUES('TSPST101',75,0,'INE155A01022');
UPDATE STOCK_BUY SET DUMMY_QUANTITY = QUANTITY WHERE TRANSACTION_ID = 'TSPST101';

insert into stock_info values('INE155A01022', 'TATA MOTORS',992.80,92.81);

insert into STOCKS values('INE155A01022','PS101',0,0,0);

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE155A01022' AND portfolio_id = 'PS101')
WHERE ISIN = 'INE155A01022' AND portfolio_id = 'PS101';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE155A01022' AND portfolio_id = 'PS101')
WHERE ISIN = 'INE155A01022' AND portfolio_id = 'PS101')
) WHERE ISIN = 'INE155A01022' AND portfolio_id = 'PS101';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE155A01022' AND PORTFOLIO_ID = 'PS101')
WHERE STOCKS.ISIN = 'INE155A01022' AND PORTFOLIO_ID = 'PS101';

-- SELLING STOCKS OF TATA FOR PS101

INSERT INTO TRANSACTIONS VALUES('TSTSP101','PS101',-37500,'STOCKS','2025-01-29');

INSERT INTO STOCK_SELL VALUES('TSTSP101',25,'INE155A01022');

UPDATE STOCK_BUY SET dummy_quantity = 50 WHERE transaction_id = 'TSPST101';

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE155A01022' AND portfolio_id = 'PS101')
WHERE ISIN = 'INE155A01022' AND portfolio_id = 'PS101';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE155A01022' AND portfolio_id = 'PS101')
WHERE ISIN = 'INE155A01022' AND portfolio_id = 'PS101')
) WHERE ISIN = 'INE155A01022' AND portfolio_id = 'PS101';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE155A01022' AND PORTFOLIO_ID = 'PS101')
WHERE STOCKS.ISIN = 'INE155A01022' AND PORTFOLIO_ID = 'PS101';

-- BUYING STOCKS OF JUBILANT FOOD FOR 5TH USER (NIHAR SAGAR)

INSERT INTO TRANSACTIONS VALUES('TCKST101','NS101',27950,'STOCKS','2025-01-27');

insert into STOCK_BUY VALUES('TCKST101',75,0,'INE797F01020');
UPDATE STOCK_BUY SET DUMMY_QUANTITY = QUANTITY WHERE TRANSACTION_ID = 'TCKST101';

insert into stock_info values('INE797F01020', 'JUBILANT FOOD',448.85,66.54);

insert into STOCKS values('INE797F01020','NS101',0,0,0);

UPDATE STOCKS SET total_quantity = 
(SELECT SUM(DUMMY_QUANTITY) FROM STOCK_BUY JOIN TRANSACTIONS ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID 
WHERE ISIN = 'INE797F01020' AND portfolio_id = 'NS101')
WHERE ISIN = 'INE797F01020' AND portfolio_id = 'NS101';

UPDATE STOCKS SET average_price_per_share = (
  SELECT ROUND(SUM(PRICE_PER_SHARE*dummy_quantity)/total_quantity,2) FROM
(
  SELECT AMOUNT/QUANTITY AS PRICE_PER_SHARE, dummy_quantity FROM (
  SELECT * FROM 
TRANSACTIONS 
JOIN STOCK_BUY 
ON STOCK_BUY.TRANSACTION_ID = TRANSACTIONS.TRANSACTION_ID
WHERE ISIN = 'INE797F01020' AND portfolio_id = 'NS101')
WHERE ISIN = 'INE797F01020' AND portfolio_id = 'NS101')
) WHERE ISIN = 'INE797F01020' AND portfolio_id = 'NS101';

UPDATE STOCKS 
SET net_gain = 
(SELECT ROUND((current_value-average_price_per_share)*total_quantity,2) FROM STOCKS JOIN STOCK_INFO ON STOCKS.ISIN = STOCK_INFO.ISIN
WHERE STOCKS.ISIN = 'INE797F01020' AND PORTFOLIO_ID = 'NS101')
WHERE STOCKS.ISIN = 'INE797F01020' AND PORTFOLIO_ID = 'NS101';

-- STOCKS TABLE FINALLY

 




-- TRANSACTIONS AFTER STOCKS

 

-- STOCK_BUY AFTER STOCKS

 
-- STOCK_SELL AFTER STOCKS

 

-- STOCK_INFO AFTER STOCKS

 


-- making some fixed deposits

INSERT INTO FIXED_DEPOSITS VALUES('2025-01-08','AGFD1223408',3,'HDFC',7.8,'AG101',34730);
INSERT INTO FIXED_DEPOSITS VALUES('2025-02-08','AGFD1223408',4,'HDFC',9.4,'AG102',349734);
INSERT INTO FIXED_DEPOSITS VALUES('2025-01-19','SKFD40834142',2,'HDFC',9.3,'SK101',65424);
INSERT INTO FIXED_DEPOSITS VALUES('2025-02-23','SKFD40834142',1.5,'HDFC',8.8,'SK102',87398);
INSERT INTO FIXED_DEPOSITS VALUES('2025-01-14','JKFD23934934',2.5,'ICICI',7.4,'JK101',384713);
INSERT INTO FIXED_DEPOSITS VALUES('2025-02-13','PSFD814304359',1,'SBI',8.7,'PS101',7987953);
INSERT INTO FIXED_DEPOSITS VALUES('2025-03-07','NSFD4839494135',7,'PNB',9.1,'NS101',2373429);
INSERT INTO FIXED_DEPOSITS VALUES('2025-03-08','AGFD33144455',6,'HDFC',9.8,'AG102',631876);

-- SELECT * FROM FIXED_DEPOSITS

 

-- making some government bonds

INSERT INTO GOVT_BONDS VALUES('SGB101','2025-02-18',98000,2,14.2,'AG101');
INSERT INTO GOVT_BONDS VALUES('SGB102','2025-03-18',34000,2.5,11.7,'SK101');
INSERT INTO GOVT_BONDS VALUES('NPS101','2025-03-11',111000,11,14.4,'AG102');
INSERT INTO GOVT_BONDS VALUES('FRN101','2025-01-17',18000,2,9.1,'JK101');
INSERT INTO GOVT_BONDS VALUES('TBS101','2025-03-22',45000,3,6.8,'PS101');
INSERT INTO GOVT_BONDS VALUES('TIPS101','2025-03-29',42000,4,15.2,'NS101');
INSERT INTO GOVT_BONDS VALUES('NPS102','2025-01-25',131000,12,13.7,'SK102');

-- SELECT * FROM GOVT_BONDS

 
-- RETURNS ON FIXED_DEPOSITS FOR EACH FD AT THE END OF TENURE

SELECT account_no, 
portfolio_id,
amount AS PRINCIPAL_AMOUNT,
ROUND((AMOUNT*POWER(1+return_on_investment*0.01,duration)- AMOUNT),2) AS RETURNS
FROM FIXED_DEPOSITS;

 

-- RETURNS ON GOVT_BONDS FOR EACH GB AT THE END OF TENURE

SELECT BOND_ID, 
portfolio_id,
amount AS PRINCIPAL_AMOUNT,
ROUND((AMOUNT*POWER(1+return_on_investment*0.01,duration)- AMOUNT),2) AS RETURNS
FROM GOVT_BONDS;

 




-- TOTAL RETURNS FOR A USER FROM ALL THE FIXED_DEPOSITS IN HIS PORTFOLIOS

SELECT USER.NAME AS USERNAME, ROUND(SUM(ROUND((AMOUNT*POWER(1+return_on_investment*0.01,duration)- AMOUNT),2)),2) AS TOTAL_RETURNS FROM 
FIXED_DEPOSITS JOIN PORTFOLIO ON FIXED_DEPOSITS.PORTFOLIO_ID = PORTFOLIO.PORTFOLIO_ID 
JOIN USER ON PORTFOLIO.PAN_ID = USER.PAN_ID
WHERE USER.NAME = 'AKASH GOSWAMI';

 

-- TOTAL RETURNS FOR A USER FROM ALL THE GOVT_BONDS IN HIS PORTFOLIOS

SELECT USER.NAME AS USERNAME, ROUND(SUM(ROUND((AMOUNT*POWER(1+return_on_investment*0.01,duration)- AMOUNT),2)),2) AS TOTAL_RETURNS FROM 
GOVT_BONDS JOIN PORTFOLIO ON GOVT_BONDS.PORTFOLIO_ID = PORTFOLIO.PORTFOLIO_ID 
JOIN USER ON PORTFOLIO.PAN_ID = USER.PAN_ID
WHERE USER.NAME = 'SUHAAS KARTHIKEYAN';

 

--INITIALIZE SCHEMES TABLE WITH MUTUAL FUNDS SCHEMES
INSERT INTO SCHEMES VALUES(120,'Kotak Smallcap Fund'),
  (111,'Quant Mid Cap Fund'),
                          (99,'SBI Large Cap Fund');
 
--1
--buy 100 units of Kotak Smallcap Fund
insert into TRANSACTIONS values('TKSMF100','JK101',12000,'mutual funds','2023-12-29');
 
insert into MUTUAL_FUNDS values(100,'Kotak Smallcap Fund','2023-12-29','KOTKS101','JK101');
insert into sip values('2023-12-29',100,100,120,'KOTKS101','JK101');
update schemes set current_nav=118 where debt_issuer='Kotak Smallcap Fund';
insert into sip values('2025-01-18',101.695,101.695,118,'KOTKS101','JK101');
update MUTUAL_FUNDS set balance_units=balance_units+101.695 where folio_id='KOTKS101';
update schemes set current_nav=110 where debt_issuer='Kotak Smallcap Fund';
--TOP-UPS FOR LUMPSUMS INCLUDED IN SIP TABLE
insert into sip values('2025-01-22',40,40,110,'KOTKS101','JK101');
update MUTUAL_FUNDS set balance_units=balance_units+40 where folio_id='KOTKS101';
--MUTUAL_FUNDS AFTER ALL TRANSACTIONS PERTAINING TO ABOVE PORTFOLIO
  
--2
--buy 200 units of Quant Mid Cap Fund
insert into TRANSACTIONS values('TAPMF104','AG102',22200,'mutual funds','2023-12-30');
insert into MUTUAL_FUNDS values(200,'Quant Mid Cap Fund','2023-12-30','QUAAP101','AG102');
insert into sip values('2023-12-30',200,200,111,'QUAAP101','AG102');
update schemes set current_nav=100 where debt_issuer='Quant Mid Cap Fund';
insert into sip values('2025-01-29',222,222,100,'QUAAP101','AG102');
update MUTUAL_FUNDS set balance_units=balance_units+222 where folio_id='QUAAP101';
--3 
--buy 180 of SBI Large Cap Fund this transaction is a lumpsum will not have further installments
insert into TRANSACTIONS values('TKSMF105','JK101',17820,'mutual funds','2025-01-8');
insert into MUTUAL_FUNDS values(180,'SBI Large Cap Fund','2025-01-8','SBIKS102','JK101');
--MUTUAL_FUNDS FINAL TABLE
 

--TRANSACTIONS FINAL TABLE( MUTUAL FUND TRANSACTIONS)
 
--SIP TABLE FINAL
 



SELECT * FROM TRANSACTIONS;

select * from STOCKS;

SELECT * FROM STOCK_INFO;

SELECT * FROM STOCK_BUY;

SELECT * FROM STOCK_SELL;

select * from user;

SELECT * FROM PORTFOLIO;

SELECT * FROM FIXED_DEPOSITS;

SELECT * FROM GOVT_BONDS;

